steps:
  - group: "Allow Fail"
    steps:
      - label: "Launch allowed-to-fail build jobs"
        plugins:
          - JuliaCI/external-buildkite#v1:
              version: "./.buildkite-external-version"
              repo_url: "https://github.com/JuliaCI/julia-buildkite"
        commands: |
          # Launch Linux allowed-to-fail build jobs
          GROUP="Allow Fail" \
              ALLOW_FAIL="true" \
              bash .buildkite/utilities/arches_pipeline_upload.sh \
              .buildkite/pipelines/main/platforms/build_linux.soft_fail.arches \
              .buildkite/pipelines/main/platforms/build_linux.yml
          # Launch macOS allowed-to-fail build jobs
          GROUP="Allow Fail" \
              ALLOW_FAIL="true" \
              bash .buildkite/utilities/arches_pipeline_upload.sh \
              .buildkite/pipelines/main/platforms/build_macos.soft_fail.arches \
              .buildkite/pipelines/main/platforms/build_macos.yml
        agents:
          queue: "julia"
      - label: "Launch allowed-to-fail test jobs"
        plugins:
          - JuliaCI/external-buildkite#v1:
              version: "./.buildkite-external-version"
              repo_url: "https://github.com/JuliaCI/julia-buildkite"
        commands: |
          # Launch Linux allowed-to-fail test jobs
          GROUP="Allow Fail" \
              ALLOW_FAIL="true" \
              bash .buildkite/utilities/arches_pipeline_upload.sh \
              .buildkite/pipelines/main/platforms/test_linux.soft_fail.arches \
              .buildkite/pipelines/main/platforms/test_linux.yml
          # Launch macOS allowed-to-fail test jobs
          GROUP="Allow Fail" \
              ALLOW_FAIL="true" \
              bash .buildkite/utilities/arches_pipeline_upload.sh \
              .buildkite/pipelines/main/platforms/test_macos.soft_fail.arches \
              .buildkite/pipelines/main/platforms/test_macos.yml
        agents:
          queue: "julia"
